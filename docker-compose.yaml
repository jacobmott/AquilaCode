services:
  # Our NestJS Api
  api:
    image: 721233806080.dkr.ecr.us-east-1.amazonaws.com/aquilacode-backend
    environment:
      DATABASE_URL: mongodb://mongo:27017 #mongodb://mongodb:27017/AquilaCode #mongodb://localhost:27017
      DATABASE_NAME: "admin"
      DATABASE_USER: "admin"
      DATABASE_PASS: "<add back when needed>"
    # ports:
    #   - 3000:3000
    networks:
      - MONGO
    depends_on:
      - mongo

  # Our Angular Frontend
  frontend:
    image: 721233806080.dkr.ecr.us-east-1.amazonaws.com/aquilacode-frontend
    ports:
      - 80:80
    networks:
      - MONGO
    depends_on:
      - api
    #links:
    #  - api

  mongo:
    image: 721233806080.dkr.ecr.us-east-1.amazonaws.com/mongo
    container_name: mongo
    environment:
      MONGO_INITDB_ROOT_USERNAME: admin
      MONGO_INITDB_ROOT_PASSWORD: <add back when needed>
    #ports:
    #  - "27017:27017"
    networks:
      - MONGO
    volumes:
      - type: volume
        source: MONGO_DATA
        target: /data/db
      - type: volume
        source: MONGO_CONFIG
        target: /data/configdb

networks:
  MONGO:
    name: MONGO

volumes:
  MONGO_DATA:
    name: MONGO_DATA
  MONGO_CONFIG:
    name: MONGO_CONFIG
